{"ast":null,"code":"const {\n  reactive,\n  ref,\n  onBeforeMount,\n  onMounted\n} = Vue;\nconst app = {\n  setup() {\n    const content = ref(null);\n    const state = reactive({\n      name: 'Vue'\n    });\n    onBeforeMount(() => {\n      const websocket = {\n        data() {\n          return {\n            ws: null\n          };\n        },\n\n        created() {\n          //頁面剛進入時開啟長連線\n          this.initWebsocket();\n        },\n\n        destroyed: function () {\n          //頁面銷燬時關閉長連線\n          this.websocketclose();\n        },\n        methods: {\n          //初始websocket\n          initWebsocket() {\n            this.socket = new SockJS('http://localhost:8080/ws');\n            this.stompClient = Stomp.over(this.socket);\n            this.stompClient.connect( // headers头部信息。可添加客户端的认证信息。也可以不添加信息，headers 直接就设置为 {}\n            header => {\n              header;\n            }, frame => {\n              websocket.data().ws = this;\n              console.log(frame);\n              this.stompClient.subscribe('/topic/bind', function (data) {\n                let orderList = [];\n\n                if (wsStore.currentOrder.value !== undefined) {\n                  orderList = wsStore.currentOrder.value.data;\n                }\n\n                const currentData = JSON.parse(data.body);\n                let exists = false;\n                orderList.forEach(element => {\n                  if (element.orderId === currentData.orderId) {\n                    element.data.concat(currentData.data);\n                    exists = true;\n                  }\n                });\n\n                if (!exists) {\n                  orderList.push(currentData);\n                }\n\n                wsStore.currentOrder.value = orderList;\n                console.log(wsStore.currentOrder.value); // console.log('ddd' + data)\n              });\n              this.stompClient.send('/app/testMsg', {}, JSON.stringify({\n                clientId: 'jjj'\n              })); //   this.connectSucceed()\n            }, err => {\n              this.initWebsocket; // 连接失败的回调\n\n              console.log(err); //   this.reconnect(this.socketUrl, this.connectSucceed)\n            });\n          }\n\n        }\n      };\n    });\n    onMounted(() => {\n      console.log('[onMounted]');\n      console.log('ref: ', content.value.outerHTML);\n      console.log('-------------');\n    });\n\n    function changeText() {\n      state.name = 'Vue 3.x';\n    }\n\n    function unmount() {\n      myVue.unmount();\n    }\n\n    return {\n      state,\n      changeText,\n      content,\n      unmount\n    };\n  }\n\n};","map":{"version":3,"names":["reactive","ref","onBeforeMount","onMounted","Vue","app","setup","content","state","name","websocket","data","ws","created","initWebsocket","destroyed","websocketclose","methods","socket","SockJS","stompClient","Stomp","over","connect","header","frame","console","log","subscribe","orderList","wsStore","currentOrder","value","undefined","currentData","JSON","parse","body","exists","forEach","element","orderId","concat","push","send","stringify","clientId","err","outerHTML","changeText","unmount","myVue"],"sources":["C:/Users/user/Desktop/admin/coreui-free-vue-admin-template-main/coreui-free-vue-admin-template-main/src/websocket.js"],"sourcesContent":["const { reactive, ref, onBeforeMount, onMounted } = Vue\nconst app = {\n  setup() {\n    const content = ref(null)\n    const state = reactive({ name: 'Vue' })\n    onBeforeMount(() => {\n      const websocket = {\n        data() {\n          return {\n            ws: null,\n          }\n        },\n        created() {\n          //頁面剛進入時開啟長連線\n          this.initWebsocket()\n        },\n        destroyed: function () {\n          //頁面銷燬時關閉長連線\n          this.websocketclose()\n        },\n        methods: {\n          //初始websocket\n          initWebsocket() {\n            this.socket = new SockJS('http://localhost:8080/ws')\n            this.stompClient = Stomp.over(this.socket)\n            this.stompClient.connect(\n              // headers头部信息。可添加客户端的认证信息。也可以不添加信息，headers 直接就设置为 {}\n              (header) => {\n                header\n              },\n              (frame) => {\n                websocket.data().ws = this\n                console.log(frame)\n                this.stompClient.subscribe('/topic/bind', function (data) {\n                  let orderList = []\n                  if (wsStore.currentOrder.value !== undefined) {\n                    orderList = wsStore.currentOrder.value.data\n                  }\n                  const currentData = JSON.parse(data.body)\n                  let exists = false\n                  orderList.forEach((element) => {\n                    if (element.orderId === currentData.orderId) {\n                      element.data.concat(currentData.data)\n                      exists = true\n                    }\n                  })\n                  if (!exists) {\n                    orderList.push(currentData)\n                  }\n                  wsStore.currentOrder.value = orderList\n                  console.log(wsStore.currentOrder.value)\n                  // console.log('ddd' + data)\n                })\n                this.stompClient.send(\n                  '/app/testMsg',\n                  {},\n                  JSON.stringify({ clientId: 'jjj' }),\n                )\n                //   this.connectSucceed()\n              },\n              (err) => {\n                this.initWebsocket\n                // 连接失败的回调\n                console.log(err)\n                //   this.reconnect(this.socketUrl, this.connectSucceed)\n              },\n            )\n          },\n        },\n      }\n    })\n    onMounted(() => {\n      console.log('[onMounted]')\n      console.log('ref: ', content.value.outerHTML)\n      console.log('-------------')\n    })\n    function changeText() {\n      state.name = 'Vue 3.x'\n    }\n    function unmount() {\n      myVue.unmount()\n    }\n    return { state, changeText, content, unmount }\n  },\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}