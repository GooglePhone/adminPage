{"ast":null,"code":"import SockJS from 'sockjs-client/dist/sockjs.min.js';\nimport Stomp from 'webstomp-client';\nimport { wsStore } from './wsStore';\nconst app = {\n  setup() {\n    const content = ref(null);\n    const state = reactive({\n      name: 'Vue'\n    });\n    onBeforeMount(() => {\n      const websocket = {\n        data() {\n          return {\n            ws: null\n          };\n        },\n\n        created() {\n          //頁面剛進入時開啟長連線\n          this.initWebsocket();\n        },\n\n        destroyed: function () {\n          //頁面銷燬時關閉長連線\n          this.websocketclose();\n        },\n        methods: {\n          //初始websocket\n          initWebsocket() {\n            this.socket = new SockJS('http://localhost:8080/ws');\n            this.stompClient = Stomp.over(this.socket);\n            this.stompClient.connect( // headers头部信息。可添加客户端的认证信息。也可以不添加信息，headers 直接就设置为 {}\n            header => {\n              header;\n            }, frame => {\n              websocket.data().ws = this;\n              console.log(frame);\n              this.stompClient.subscribe('/topic/bind', function (data) {\n                let orderList = [];\n\n                if (wsStore.currentOrder.value !== undefined) {\n                  orderList = wsStore.currentOrder.value.data;\n                }\n\n                const currentData = JSON.parse(data.body);\n                let exists = false;\n                orderList.forEach(element => {\n                  if (element.orderId === currentData.orderId) {\n                    element.data.concat(currentData.data);\n                    exists = true;\n                  }\n                });\n\n                if (!exists) {\n                  orderList.push(currentData);\n                }\n\n                wsStore.currentOrder.value = orderList;\n                console.log(wsStore.currentOrder.value); // console.log('ddd' + data)\n              });\n              this.stompClient.send('/app/testMsg', {}, JSON.stringify({\n                clientId: 'jjj'\n              })); //   this.connectSucceed()\n            }, err => {\n              this.initWebsocket; // 连接失败的回调\n\n              console.log(err); //   this.reconnect(this.socketUrl, this.connectSucceed)\n            });\n          }\n\n        }\n      };\n    });\n    onMounted(() => {\n      console.log('[onMounted]');\n      console.log('ref: ', content.value.outerHTML);\n      console.log('-------------');\n    });\n\n    function changeText() {\n      state.name = 'Vue 3.x';\n    }\n\n    function unmount() {\n      myVue.unmount();\n    }\n\n    return {\n      state,\n      changeText,\n      content,\n      unmount\n    };\n  }\n\n};","map":{"version":3,"names":["SockJS","Stomp","wsStore","app","setup","content","ref","state","reactive","name","onBeforeMount","websocket","data","ws","created","initWebsocket","destroyed","websocketclose","methods","socket","stompClient","over","connect","header","frame","console","log","subscribe","orderList","currentOrder","value","undefined","currentData","JSON","parse","body","exists","forEach","element","orderId","concat","push","send","stringify","clientId","err","onMounted","outerHTML","changeText","unmount","myVue"],"sources":["C:/Users/user/Desktop/admin/coreui-free-vue-admin-template-main/coreui-free-vue-admin-template-main/src/websocket.js"],"sourcesContent":["import SockJS from 'sockjs-client/dist/sockjs.min.js'\nimport Stomp from 'webstomp-client'\nimport { wsStore } from './wsStore'\nconst app = {\n  setup() {\n    const content = ref(null)\n    const state = reactive({ name: 'Vue' })\n    onBeforeMount(() => {\n      const websocket = {\n        data() {\n          return {\n            ws: null,\n          }\n        },\n        created() {\n          //頁面剛進入時開啟長連線\n          this.initWebsocket()\n        },\n        destroyed: function () {\n          //頁面銷燬時關閉長連線\n          this.websocketclose()\n        },\n        methods: {\n          //初始websocket\n          initWebsocket() {\n            this.socket = new SockJS('http://localhost:8080/ws')\n            this.stompClient = Stomp.over(this.socket)\n            this.stompClient.connect(\n              // headers头部信息。可添加客户端的认证信息。也可以不添加信息，headers 直接就设置为 {}\n              (header) => {\n                header\n              },\n              (frame) => {\n                websocket.data().ws = this\n                console.log(frame)\n                this.stompClient.subscribe('/topic/bind', function (data) {\n                  let orderList = []\n                  if (wsStore.currentOrder.value !== undefined) {\n                    orderList = wsStore.currentOrder.value.data\n                  }\n                  const currentData = JSON.parse(data.body)\n                  let exists = false\n                  orderList.forEach((element) => {\n                    if (element.orderId === currentData.orderId) {\n                      element.data.concat(currentData.data)\n                      exists = true\n                    }\n                  })\n                  if (!exists) {\n                    orderList.push(currentData)\n                  }\n                  wsStore.currentOrder.value = orderList\n                  console.log(wsStore.currentOrder.value)\n                  // console.log('ddd' + data)\n                })\n                this.stompClient.send(\n                  '/app/testMsg',\n                  {},\n                  JSON.stringify({ clientId: 'jjj' }),\n                )\n                //   this.connectSucceed()\n              },\n              (err) => {\n                this.initWebsocket\n                // 连接失败的回调\n                console.log(err)\n                //   this.reconnect(this.socketUrl, this.connectSucceed)\n              },\n            )\n          },\n        },\n      }\n    })\n    onMounted(() => {\n      console.log('[onMounted]')\n      console.log('ref: ', content.value.outerHTML)\n      console.log('-------------')\n    })\n    function changeText() {\n      state.name = 'Vue 3.x'\n    }\n    function unmount() {\n      myVue.unmount()\n    }\n    return { state, changeText, content, unmount }\n  },\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}